# ADR-002: Ограничение одного голоса на пользователя
Дата: 2025-10-20
Статус: Accepted

## Context
Требуется:
- Один пользователь — один голос за фичу
- Защита от спама и фальсификации
- Без дублирования логики

Альтернативы:
- Проверка в роуте → дублирование
- База данных: UNIQUE(user_id, feature_id) → избыточно для in-memory
- Кеш (Redis) → усложнение архитектуры

## Decision
Реализовать логику в `Vote_dao`:
- Хранить голоса в `dict` по ключу `(user_id, feature_id)`
- При попытке дубля — обновлять голос (смена выбора)
- Использовать в `POST /features/{id}/vote`

## Consequences
**Плюсы:**
- Централизованная логика
- Легко тестировать
- Работает без БД

**Минусы:**
- При перезапуске — данные теряются

**Trade-offs:**
- Выбран in-memory подход для первоначальной реализации
- Потеря данных при рестарте — принято (NFR-09)

## Security impact
- Закрывает **R2 (Фальсификация фич)** через контроль голосов
- Соответствует **NFR-03**

## Rollout plan
- Внедрено в `model_dao_service.py`
- Проверено интеграционными тестами

## Links
- NFR-03
- R2
- `tests/test_vote.py::test_user_cannot_vote_twice`
- `src/dao.py`, `src/model_dao_service.py`
