# ADR-001: Использование JWT для аутентификации в FastAPI
Дата: 2025-10-20
Статус: Accepted

## Context
Нужно обеспечить безопасный доступ к эндпоинтам:
- Только авторизованные пользователи могут голосовать
- Админ может управлять фичами
- Без сессий (stateless), чтобы упростить масштабирование

Альтернативы:
- Сессии с куками → требует хранилища (Redis), сложнее масштабировать
- OAuth2 с провайдером (Google) → избыточно для внутреннего сервиса
- API Keys → не подходит для пользователей

## Decision
Реализовать аутентификацию через:
- JWT (HS256) с `python-jose`
- `OAuth2PasswordBearer` из FastAPI
- Токен возвращается на `/auth/login`
- Все защищённые роуты используют `Depends(get_current_user)`

Параметры:
- `SECRET_KEY` — из переменных окружения
- Срок жизни токена: 30 минут
- Хранение паролей: `bcrypt` (в памяти)

## Consequences
**Плюсы:**
- Stateless → легко масштабировать
- Поддержка Swagger UI (`Authorize`)
- Простая интеграция с FastAPI

**Минусы:**
- Нельзя "разлогинить" до истечения срока
- Токен хранится на клиенте

**Trade-offs:**
- Выбран JWT вместо сессий ради простоты
- `bcrypt` вместо `argon2id` — ограничение совместимости

## Security impact
- Закрывает риск **R1 (Подмена пользователя)** частично (требуется MFA в будущем)
- Соответствует **NFR-05**: все эндпоинты защищены

## Rollout plan
- Включено в `p05-secure-coding`
- Проверено через Swagger UI и тесты
- Feature-flag не требуется

## Links
- NFR-05
- R1
- `tests/test_auth.py::test_login_success`
- `src/main.py`, `src/auth.py`
