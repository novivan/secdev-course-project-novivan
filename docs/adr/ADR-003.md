# ADR-003: Использование RFC 7807 для ошибок
Дата: 2025-10-20
Статус: Accepted

## Context
Нужно:
- Единый формат ошибок
- Маскировать детали (не показывать stack trace)
- Поддержка `correlation_id` для логирования

Альтернативы:
- Простой JSON (`{"error": "..."}`) → нет стандартизации
- Кастомные коды → сложно интегрировать
- Sentry → внешняя зависимость

## Decision
Использовать RFC 7807 (`application/problem+json`):
- Реализовать через `problem()`-хелпер
- Все ошибки — в этом формате
- `correlation_id` генерируется для каждого запроса

## Consequences
**Плюсы:**
- Стандартный формат
- Удобно для клиентов
- Поддержка `correlation_id` помогает в отладке

**Минусы:**
- Дополнительный код
- Не все клиенты поддерживают `application/problem+json`

**Trade-offs:**
- Выбран RFC 7807 ради соответствия NFR

## Security impact
- Закрывает **R3 (Отказ от голосования)** через логирование
- Соответствует **NFR-07**

## Rollout plan
- Добавлен обработчик ошибок
- Проверено тестами

## Links
- NFR-07
- R3
- `tests/test_errors.py::test_rfc7807_format`
- `src/error_handler.py`
