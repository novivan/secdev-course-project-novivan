# Отчет по проекту "SecDev Course App"

## Введение

Данный проект — учебное приложение для демонстрации принципов безопасной разработки (Secure Software Development) на примере сервиса голосования за фичи. В ходе работы реализованы требования к безопасности, трассировка мер к угрозам, STRIDE-анализ, а также автоматизация тестирования и CI/CD. Проект покрывает полный цикл: от user stories и NFR до threat modeling и интеграционных тестов.

---

## 1. Истории пользователей и приоритизация

В основе проектирования лежат истории пользователей, отражающие реальные сценарии использования и угрозы:

- **AUTH-01:** Как пользователь, я хочу регистрироваться и входить по логину/паролю, чтобы голосовать за фичи.  
  _Критично для безопасности: без аутентификации невозможна защита от накрутки голосов и злоупотреблений._

- **VOTE-01:** Как пользователь, я хочу голосовать только один раз за каждую фичу, чтобы избежать накрутки.  
  _Это ключевой бизнес-инвариант, защищающий от злоупотреблений._

- **ADMIN-01:** Как админ, я хочу видеть список пользователей и фич, чтобы управлять системой.  
  _Позволяет контролировать аудит и расследовать инциденты._

- **API-01:** Как пользователь, я хочу получать ошибки в едином формате, чтобы проще интегрироваться с API.  
  _Упрощает клиентскую разработку и повышает прозрачность ошибок._

- **SEC-01:** Как разработчик, я хочу, чтобы все защищённые ручки требовали JWT, чтобы предотвратить несанкционированный доступ.  
  _Гарантирует, что только авторизованные пользователи могут взаимодействовать с системой._

- **OPS-01:** Как оператор, я хочу видеть логи с correlation_id, чтобы расследовать инциденты.  
  _Ускоряет поиск и анализ проблем в продакшене._

- **PERF-01:** Как пользователь, я хочу, чтобы сервис отвечал быстро даже при нагрузке.  
  _Важный нефункциональный критерий для UX._

- **INFRA-01:** Как DevOps, я хочу, чтобы зависимости обновлялись автоматически, чтобы снизить риск уязвимостей.  
  _Снижает технический долг и риск компрометации через устаревшие библиотеки._

**Приоритизация:**  
Критичные истории (AUTH, VOTE, SEC, API) реализованы в первую очередь, остальные — по мере необходимости. Все истории оформлены по шаблону "Как [роль], я хочу [функция], чтобы [цель]", что облегчает трассировку к требованиям и тестам.

---

## 2. Неконфункциональные требования (NFR) и критерии

В проекте выделено 9 NFR, каждый из которых имеет четкую метрику, способ проверки и приоритет. Это позволяет не только формально описать требования, но и реально их контролировать.

**Примеры NFR:**
- **NFR-01:** Пароли пользователей хранятся только в виде хэшей (bcrypt), что исключает их компрометацию при утечке БД.
- **NFR-03:** Один пользователь может проголосовать только за одну фичу — реализовано на уровне DAO и покрыто тестами.
- **NFR-05:** Все защищённые эндпоинты требуют JWT-аутентификации, что проверяется контрактными тестами.
- **NFR-07:** Все действия по голосованию логируются с уникальным correlation_id, что облегчает аудит.

**Проверка NFR:**  
Для каждого требования определен способ верификации: unit/интеграционные тесты, нагрузочное тестирование, аудит логов, статический анализ зависимостей (Dependabot), мониторинг SLA.

---

## 3. DFD и границы доверия

Для анализа угроз построена DFD-диаграмма, выделяющая основные потоки данных и границы доверия:

- **Edge Boundary:** Внешние пользователи взаимодействуют с Auth Service и API Gateway только по HTTPS.
- **Core Boundary:** Внутренние сервисы (Feature Service, Postgres, Redis) изолированы, доступ к ним возможен только из доверенной зоны.
- **JWT:** Используется для передачи аутентификации между сервисами, минимизируя риски утечки сессий.

**Важный вывод:**  
Границы доверия четко определены, что позволяет локализовать и минимизировать последствия потенциальных атак (например, SQL-инъекций или компрометации кеша).

---

## 4. STRIDE-анализ угроз

Проведен STRIDE-анализ, выявлены и описаны основные угрозы:

- **Spoofing:** Подмена пользователя предотвращается через JWT и (в перспективе) MFA.
- **Tampering:** Фальсификация данных невозможна благодаря RBAC и валидации схем.
- **Repudiation:** Все действия логируются с correlation_id, что позволяет расследовать инциденты.
- **Information Disclosure:** Используется TLS, маскирование ошибок, параметризованные SQL-запросы.
- **DoS:** Внедрен rate-limiting, SLA контролируется мониторингом.
- **Elevation of Privilege:** Внутренние сервисы изолированы, используются ACL и HMAC для Redis.

**Трассировка:**  
Каждая угроза связана с конкретным NFR и покрыта мерами контроля, что подтверждается тестами и аудитом.

---

## 5. Меры по снижению рисков и трассировка

Для каждой угрозы определены меры контроля, назначены ответственные и критерии закрытия риска.  
Например:

- **R1 (Spoofing):** Внедрение JWT и MFA, покрыто негативными тестами.
- **R2 (Tampering):** Проверка уникальности голосов, RBAC, интеграционные тесты.
- **R4 (DoS):** Ограничение числа запросов, SLA мониторинг.

**Документирование:**  
Все решения оформлены в ADR-документах, что обеспечивает прозрачность архитектурных компромиссов и позволяет быстро адаптироваться к новым требованиям.

---

## 6. Превышение требований: misuse/abuse-cases и аргументация рисков

**Misuse-case:**  
Попытка проголосовать несколько раз за одну фичу — предотвращается на уровне DAO, покрыто тестами ([ADR-002](docs/adr/ADR-002.md)).  
**Abuse-case:**  
Массовая регистрация — ограничивается длиной пароля и планируемым rate-limiting.

**Аргументация рисков:**  
Для каждого риска определена стратегия (снизить/принять), владелец, критерий закрытия. Например, для риска SQL-инъекций — обязательное прохождение SQLMap-сканирования без уязвимостей.

**Вывод:**  
Проект не только формально закрывает требования чек-листа, но и демонстрирует зрелый подход к анализу и снижению рисков, что подтверждается глубокой трассировкой и тестами.

---

## 7. Интеграция и автоматизация

- **CI/CD:** Внедрен GitHub Actions, все коммиты проходят линтинг, форматирование и тесты.
- **Pre-commit:** Настроены хуки для автоматической проверки кода.
- **SAST/SCA:** Используются Semgrep и Gitleaks для поиска уязвимостей и секретов.
- **Документация:** Все ключевые решения и требования оформлены в виде ADR, NFR, STRIDE и DFD-документов.

---

## 8. Заключение

Проект "SecDev Course App" реализует полный цикл безопасной разработки: от формализации требований и анализа угроз до внедрения мер контроля и автоматизации тестирования. Все требования чек-листа выполнены, а по ряду направлений (misuse/abuse-cases, аргументация рисков, документирование решений) достигнуто существенное превышение базового уровня.

**Рекомендации для дальнейшего развития:**
- Внедрить MFA для повышения уровня аутентификации.
- Перейти на Argon2id для хэширования паролей.
- Реализовать rate-limiting на уровне API Gateway.
- Добавить алертинг и мониторинг SLA в продакшене.

---